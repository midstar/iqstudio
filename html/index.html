<html>
<meta charset="utf-8"/>
<head>
<title>IQ Data Studio</title>
<style>

canvas {
    border:1px solid #000000;
    margin-bottom: 5px;
}

.select-container {
    display: inline-block;
    vertical-align: top;
    border:1px solid lightgray;
    margin: 2px 0px 2px 0px;
    padding: 5px 5px 0px 5px;
}

.select-label {
    display: inline-block;
    width: 60px;
    text-align:center;
}

#I_range, #Q_range {
    width: 100%;
}

#I_plot, #Q_plot {
    float: right;
}


</style>
</head>
<script>

//////////////////////////////////////////////////////////
// Globals
//////////////////////////////////////////////////////////

const DEG_TO_RAD = Math.PI / 180;

//////////////////////////////////////////////////////////
// Functions
//////////////////////////////////////////////////////////

window.onload = function() {
    updateDisplay();

    // Synchronize range and number inputs - I
    var I_range = document.getElementById("I_range");
    var I_number = document.getElementById("I_number");
    I_range.addEventListener('input', function (e) {
        I_number.value = e.target.value;
        updateDisplay();
    });
    I_number.addEventListener('input', function (e) {
        I_range.value = e.target.value;
        updateDisplay();
    });

    // Synchronize range and number inputs - Q
    var Q_range = document.getElementById("Q_range");
    var Q_number = document.getElementById("Q_number");
    Q_range.addEventListener('input', function (e) {
        Q_number.value = e.target.value;
        updateDisplay();
    });
    Q_number.addEventListener('input', function (e) {
        Q_range.value = e.target.value;
        updateDisplay();
    });

}

function updateDisplay() {
    var canvas = document.getElementsByClassName("signal-plot");
    var width = document.body.offsetWidth;
    for (var i = 0; i < canvas.length ; i++) {
        canvas[i].height = 200;
        canvas[i].width = width;
    }
    
    plot("signal-canvas");
}

function plot(canvasId) {
    var I_value = document.getElementById("I_number").value;
    var Q_value = document.getElementById("Q_number").value;
    var I_plot = document.getElementById("I_plot").checked;
    var Q_plot = document.getElementById("Q_plot").checked;
    var Carrier_plot = document.getElementById("Carrier_plot").checked;
    var RF_plot = document.getElementById("RF_plot").checked;

    var canvas = document.getElementById(canvasId);
    var ctx = canvas.getContext("2d");


    var offsetPx = 5;
    var amplitudePx = canvas.height / 2 - 32;
    var periodPx = 100;
    var startY = canvas.height / 2;
    var endX = canvas.width - offsetPx;
    plotGrid(ctx, canvas.width, canvas.height, 10);

    Carrier_func = function (angle) {
        return amplitudePx * Math.cos(angle * DEG_TO_RAD);
    };

    I_func = function (angle) {
        return I_value * amplitudePx * Math.cos(angle * DEG_TO_RAD);
    };

    Q_func = function (angle) {
        return Q_value * amplitudePx * Math.sin(angle * DEG_TO_RAD);
    };

    RF_func = function (angle) {
        return I_func(angle) + Q_func(angle);
    };

    if (Carrier_plot) {
        plotFunc(ctx, periodPx, startY, offsetPx, endX,
                "lightgreen", Carrier_func);
    }

    if (I_plot) {
        plotFunc(ctx, periodPx, startY, offsetPx, endX,
                "red", I_func);
    }

    if (Q_plot) {
        plotFunc(ctx, periodPx, startY, offsetPx, endX,
                "blue", Q_func);
    }

    if (RF_plot) {
        plotFunc(ctx, periodPx, startY, offsetPx, endX,
                "green", RF_func);
    }
}

function plotGrid(ctx, width, height, space) {
    ctx.strokeStyle = "lightgray";
    ctx.beginPath();

    // Horizontal lines
    var nbrHorLines = height / space - 1;
    for (var i = 1 ; i <= nbrHorLines ; i++) {
        ctx.moveTo(0, i * space);
        ctx.lineTo(width, i * space);
    }
 
    // Vertical lines lines
    var nbrVerLines = width / space - 1;
    for (var i = 1 ; i <= nbrVerLines ; i++) {
        ctx.moveTo(i * space, 0);
        ctx.lineTo(i * space, height);
    }

    ctx.lineWidth = 1;
    ctx.stroke();    


    // Centre line (thicker)
    ctx.beginPath();
    ctx.moveTo(0, height / 2);
    ctx.lineTo(width, height / 2);
    ctx.lineWidth = 2;
    ctx.stroke();    
}

function plotFunc(ctx, periodPx, startY, startX, endX,
                  color, func) {
    var angle = -1;
    var x = 0;
    var firstPoint = true;
    ctx.beginPath();
    while(x < endX) {
        angle++;
        y = func(angle) + startY;
        x = angle * periodPx / 360 + startX;
        if (firstPoint) {
            ctx.moveTo(x, y);
            firstPoint = false;
        }
        else {
            ctx.lineTo(x, y);
        }
    }
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.stroke();
}


</script>

<body onresize="updateDisplay()">

    <div class="select-container">
        <div class="select-label"><b style="color:red">I</b></div>
        <input id="I_number" type="number" id="quantity" name="quantity" min="-1" max="1" value="1" step="0.01" size="4">
        <input id="I_plot" type="checkbox" checked onchange="updateDisplay()">
        <br>
        <input id="I_range" type="range" min="-1" max="1" value="1" step="0.01">
    </div>
    <div class="select-container">
        <div class="select-label"><b style="color:blue">Q</b></div>
        <input id="Q_number" type="number" id="quantity" name="quantity" min="-1" max="1" value="0" step="0.01" size="4">
        <input id="Q_plot" type="checkbox" checked onchange="updateDisplay()">
        <br>
        <input id="Q_range" type="range" min="-1" max="1" value="1" step="0.01">
    </div>
    <div class="select-container">
        <div class="select-label"><b style="color:lightgreen">Carrier</b></div>
        <input id="Carrier_plot" type="checkbox" checked onchange="updateDisplay()">
        <br>
        <div class="select-label"><b style="color:green">RF</b></div>
        <input id="RF_plot" type="checkbox" checked onchange="updateDisplay()">
    </div>

    <canvas id="signal-canvas" class="signal-plot"></canvas>

</body>
</html>